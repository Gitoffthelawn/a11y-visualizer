---
import LanguageSelector from "../components/LanguageSelector";
import { getTranslation } from "../lib/translations";

// Markdown layouts receive frontmatter under Astro.props.frontmatter
interface Frontmatter {
  lang?: string;
  title?: string;
}

const fm = (Astro.props as { frontmatter?: Frontmatter }).frontmatter || {};
const lang = fm.lang || "en";
const pageTitle = fm.title;
const t = getTranslation(lang);
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/a11y-visualizer/icon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{pageTitle ? `${pageTitle} - ${t.title}` : t.title}</title>
    <meta name="description" content={t.description} />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content={pageTitle ? `${pageTitle} - ${t.title}` : t.title}
    />
    <meta property="og:description" content={t.description} />
    <meta
      property="og:image"
      content="https://ymrl.github.io/a11y-visualizer/images/ogp.png"
    />
    <meta property="og:image:alt" content={t.hero.imageAlt} />
    <meta property="og:site_name" content="Accessibility Visualizer" />
    <meta
      property="og:locale"
      content={lang === "ja" ? "ja_JP" : lang === "ko" ? "ko_KR" : "en_US"}
    />
    <meta name="color-scheme" content="light dark" />
    <script>
      if (typeof window !== "undefined") {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        document.documentElement.classList.toggle("dark", theme === "dark");
      }
    </script>
  </head>
  <body class="bg-zinc-50 dark:bg-zinc-900 text-zinc-800 dark:text-zinc-300">
    <header
      class="bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-700"
    >
      <div class="max-w-6xl mx-auto px-4 sm:px-2 lg:px-8 py-2">
        <div class="flex justify-between items-center">
          <a
            href={lang === "en"
              ? "/a11y-visualizer/"
              : `/a11y-visualizer/${lang}/`}
            class="flex items-center gap-3"
          >
            <img src="/a11y-visualizer/icon.svg" alt="" class="w-8 h-8" />
            <span class="text-xl font-semibold text-teal-700 dark:text-teal-200"
              >{t.title}</span
            >
          </a>
          <LanguageSelector currentLang={lang} client:load />
        </div>
      </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <article
        class="prose prose-zinc dark:prose-invert prose-headings:scroll-mt-24 prose-h1:mb-4 prose-h2:mt-10 prose-h2:mb-4 prose-a:no-underline prose-img:rounded-lg prose-img:shadow-sm prose-hr:my-10"
      >
        <slot />
      </article>
    </main>

    <footer
      class="bg-zinc-900 dark:bg-zinc-950 text-zinc-300 dark:text-zinc-400 py-8"
    >
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p>
          {t.footer.copyright}
          <a
            href="https://github.com/ymrl/a11y-visualizer"
            class="text-teal-400 dark:text-teal-300 hover:text-teal-300 dark:hover:text-teal-200 underline"
          >
            {t.footer.github}
          </a>.
        </p>
      </div>
    </footer>
  </body>
</html>
